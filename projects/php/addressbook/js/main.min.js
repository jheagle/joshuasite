function setCustomer(e){var t=true;$(".display-create").trigger("click");$(".create-customer h2").html("Edit "+e.first_name);if($(".name-group .customer-seq").length){$(".name-group .customer-seq").val(e.seq)}else{$(".name-group").append("<input class='customer-seq' type='hidden' name='customer_seq' value='"+e.seq+"'>")}if(e.seq>0){$(".submit-create").val("Update");$(".create-customer").removeClass("create");$(".create-customer").addClass("update");$(".submit-delete").fadeIn()}else{t=false;$(".submit-create").val("Create");$(".create-customer").removeClass("update");$(".create-customer").addClass("create");$(".submit-delete").fadeOut();$(".customer-seq").remove();$(".address-seq").remove();$(".phone-seq").remove()}$(".success-status").removeClass("success-status");$(".error-status").removeClass("error-status");$(".error-msg").remove();$(".address-code").removeClass("postal").removeClass("zip");$(".create-customer .fname").val(e.first_name);$(".create-customer .mname").val(e.middle_name);$(".create-customer .lname").val(e.last_name);$.each(e.address,function(e,n){if(e>0){$(".add-address").trigger("click")}if(t){if($(".address:eq("+e+") .address-seq").length){$(".address:eq("+e+") .address-seq").val(n.seq)}else{$(".address:eq("+e+")").append("<input class='address-seq' type='hidden' name='address[seq][]' value='"+n.seq+"'>")}}var r=n.street.split("-");var i=r.length===2?$.trim(r[0]):"";var s=r.length===2?$.trim(r[1]):$.trim(n.street);var o=s.substr(0,s.indexOf(" "));var u=s.substr(s.indexOf(" ")+1);$(".address:eq("+e+") .number").val(o.replace("~","-"));$(".address:eq("+e+") .street").val(u.replace("~","-"));$(".address:eq("+e+") .apartment").val(i.replace("~","-"));$(".address:eq("+e+") .city").val(n.city);$(".address:eq("+e+") .province").val(n.province);$(".address:eq("+e+") .address-code").val(n.postal_code);$(".address:eq("+e+") .province option[value='"+n.province+"']").prop("selected",true);if($(".address:eq("+e+") .province option:selected").parent().attr("label")==="Canada"){$(".address:eq("+e+") .address-code").removeClass("zip").addClass("postal");$(".address:eq("+e+") .address-code").attr("placeholder","Postal Code");$(".country").val("Canada")}else{$(".address:eq("+e+") .address-code").removeClass("postal").addClass("zip");$(".address:eq("+e+") .address-code").attr("placeholder","Zip Code");$(".country").val("United States")}});var n=0;$.each(e.phone_number,function(e,r){$.each(r,function(e,r){if(n>0){$(".add-phone").trigger("click")}if(t){if($(".phone-number:eq("+n+") .phone-seq").length){$(".phone-number:eq("+n+") .phone-seq").val(r.seq)}else{$(".phone-number:eq("+n+")").append("<input class='phone-seq' type='hidden' name='phone[seq][]' value='"+r.seq+"'>")}}$(".phone-number:eq("+n+") .phone-type").val(r.phone_type);$(".phone-number:eq("+n+") .phone").val(addPhoneFormat(r.phone_number));++n})});$(".create-customer .email").val(e.email);$(".create-customer .notes").val(e.notes);$.post("controllers/logs_controller.php",{count:e.seq},function(e){limit=e;if(limit>10){$(".right-pager").fadeIn()}else{$(".right-pager").fadeOut()}});$.post("controllers/logs_controller.php",{customer:e.seq},function(e){var t="";$.each(e,function(e,n){t+="<tr><td>"+n.date_time+"</td><td>"+n.action+"</td><td>"+n.class_seq+"</tr>"});if(e.length<1){t="<tr><td colspan='3'>No Events Found</td></tr>"}$(".logs tbody").html(t)},"json");$(".display-all").fadeIn()}function genCSV(e){var t=e;var n="";var r="";for(var i in t[0]){var s=i+"";r+='"'+s.replace(/"/g,'""')+'",'}r=r.slice(0,-1);n+=r+"\r\n";for(var o=0;o<t.length;o++){var r="";for(var i in t[o]){var s=t[o][i]+"";r+='"'+s.replace(/"/g,'""')+'",'}r=r.slice(0,-1);n+=r+"\r\n"}return n}function addPhoneFormat(e){e=removePhoneFormat(e);var t="";if(e.length>10){var n=e.length-4;var r=n%3;if(r>0){n-=r;t=e.slice(e.length*-1,r)+" ("}else{t="("}var i=4+r-1;for(var s=n;s>0;s-=3){var o=(s+4)*-1;t+=e.slice(o,i);if(s===n){t+=") "}else{t+="-"}i+=3}t+=e.slice(-4,e.length)}else if(e.length>7){t="("+e.slice(0,3)+") "+e.slice(3,6)+"-"+e.slice(6,10)}else{t=e.slice(0,3)+"-"+e.slice(3,7)}return t}function removePhoneFormat(e){return e.replace(/\D/g,"")}function verifyCreate(){$(".sumbit-type").remove();$(".submit-type").val("Create");if($(".customer-seq").length){$(".submit-type").val("Update");return confirm("Are you sure you want to modify this customer?")}return true}function verifyDelete(){$(".sumbit-type").remove();$(".submit-type").val("Delete");return confirm("Are you sure you want to delete this customer?")}function validateSubmit(){$(".success-status").removeClass("success-status");$(".error-status").removeClass("error-status");$(".error-msg").remove();var e=false,t=false;if($(".fname").val()===""){e=true;$(".fname").addClass("error-status");$(".fname").parent().append("<ul class='error-msg'><li>Please enter the first name.</li></ul>")}else{$(".fname").addClass("success-status")}if($(".lname").val()===""){e=true;$(".lname").addClass("error-status");$(".lname").parent().append("<ul class='error-msg'><li>Please enter the last name.</li></ul>")}else{$(".lname").addClass("success-status")}$(".number").each(function(){if($(this).val()===""){e=true;$(this).addClass("error-status");$(this).parent().append("<ul class='error-msg'><li>Please enter the street number.</li></ul>")}else{$(this).addClass("success-status")}});$(".street").each(function(){var t="";if($(this).val()===""){t+="<li>Please enter the street name.</li>"}if($(this).val().split(" ").length<2){t+="<li>Please enter Name and Type (Street, Road, Avenue, etc.).</li>"}if(t.length>0){e=true;$(this).addClass("error-status");$(this).parent().append("<ul class='error-msg'>"+t+"</ul>")}else{$(this).addClass("success-status")}});$(".city").each(function(){if($(this).val()===""){e=true;$(this).addClass("error-status");$(this).parent().append("<ul class='error-msg'><li>Please enter the city name.</li></ul>")}else{$(this).addClass("success-status")}});$(".province").each(function(){if(!$("option:selected",this).length){e=true;$(this).addClass("error-status");$(this).parent().append("<ul class='error-msg'><li>Please select the province/state.</li></ul>")}else{$(this).addClass("success-status")}});$(".country").each(function(){if(!$("option:selected",this).length){e=true;$(this).addClass("error-status");$(this).parent().append("<ul class='error-msg'><li>Please select the Country.</li></ul>")}else{$(this).addClass("success-status")}});$(".postal").each(function(){var t="";if($(this).val()===""){t+="<li>Please enter the postal code.</li>"}if($(this).val().length<6){t+="<li>The postal code must be six (6) digits</li>"}if(!$(this).val().match(/[a-zA-Z][0-9][a-zA-Z](-| |)[0-9][a-zA-Z][0-9]/)){t+="<li>The postal code must be of format A9A 9A9</li>"}if(t.length>0){e=true;$(this).addClass("error-status");$(this).parent().append("<ul class='error-msg'>"+t+"</ul>")}else{$(this).addClass("success-status")}});$(".zip").each(function(){var t="";if($(this).val()===""){t+="<li>Please enter the zip code.</li>"}if($(this).val().length<5){t+="<li>The zip code must be five (5) digits</li>"}if(!$.isNumeric($(this).val())){t+="<li>The zip code can only contain numbers.</li>"}if(t.length>0){e=true;$(this).addClass("error-status");$(this).parent().append("<ul class='error-msg'>"+t+"</ul>")}else{$(this).addClass("success-status")}});$(".phone-type").each(function(){if($(this).val()==="work"){t=true}else{$(this).addClass("error-status");$(this).parent().append("<ul class='error-msg'><li>Please create at least one work number.</li></ul>")}});if(!t){e=true}else{$(".phone-type").removeClass("error-status");$(".phone-type").parent().find(".error-msg").remove();$(".phone-type").addClass("success-status")}$(".phone").each(function(){var t="",n=$(this).val().replace(/\D/g,"");if($(this).val()===""){t+="<li>Please enter the phone number.</li>"}if(n.length<10){t+="<li>The phone number must be at least ten (10) digits</li>"}if(!$.isNumeric(n)){t+="<li>The phone number can only contain numbers.</li>"}if(t.length>0){e=true;$(this).addClass("error-status");$(this).parent().append("<ul class='error-msg'>"+t+"</ul>")}else{$(this).addClass("success-status")}});if(($(".email").val().match(/.+@.+\..+/i)||[]).length<1&&$(".email").val()!==""){e=true;$(".email").addClass("error-status");$(".email").parent().append("<ul class='error-msg'><li>The email address must match similar format to 'name@domain.com'.</li></ul>")}else{$(".email").addClass("success-status")}if(e){return false}$(".phone").each(function(){$(this).val(removePhoneFormat($(this).val()))});$(".number, .street, .apartment").each(function(){$(this).val($(this).val().replace("-","~"))});return true}var searchElements=$(".search-form .form-group").find("input, select, textarea"),customers=$(),target=document.getElementById("spinner-container"),spinner=new Spinner;offset=0,limit=1e4,customerSeq=-1;$(document).ready(function(){$.post("controllers/logs_controller.php",function(e){limit=e});$(".search-field").bind("keyup change",function(){if($(this).val()===""){$(".search-form").trigger("submit")}});$(".search-form").submit(function(){spinner.spin();$(".search-phone").val(removePhoneFormat($(".search-phone").val()));target.appendChild(spinner.el);$.post($(this).attr("action"),$(".search-form").serialize(),function(e){$("#customer-list").empty();if(e.length<1){$("#customer-list").html("<option value='-1'>Create New Customer</option>")}if(e.length===1&&e[0].seq==-1){customers.push(e[0]);$("#customer-list").html("<option value='-1'>Create Customer: "+e[0].first_name+" "+e[0].middle_name+" "+e[0].last_name+"</option>")}else{$.each(e,function(e,t){$("#customer-list").append("<option value='"+t.seq+"'>"+t.last_name+", "+t.first_name+" "+t.middle_name+"</option>")})}if(!searchElements.attr("disabled")){$(".more-filters").trigger("click")}spinner.stop()},"json");return false});$(".more-filters").click(function(){$(this).addClass("force-right");$(".search-form").trigger("reset");$("#search-options").slideToggle();$("#customer-list").slideToggle(function(){if(searchElements.attr("disabled")){$(".more-filters").removeClass("force-right")}});if(searchElements.attr("disabled")){searchElements.removeAttr("disabled")}else{searchElements.attr("disabled","disabled")}$(this).val($(this).val()==="\u25B2"?"\u25BC":"\u25B2")});$("#customer-list").on("click, change",function(){if($("#customer-list option:selected").length){customerSeq=$("#customer-list option:selected").val();var e=false;offset=0;$(".left-pager").fadeOut();$.each(customers,function(t,n){if(n.seq===customerSeq){e=true;setCustomer(n);return}});if(!e){$.post("controllers/addressbook_controller.php",{customer_seq:customerSeq},function(e){customers.push(e);setCustomer(e);return},"json")}}});$("#import").click(function(e){e.preventDefault();var t=document.createElement("input");t.type="file";t.name="csv-file";t.className="file-input";$(".search-form").append(t);t.click();t.trigger("change");$(".file-input").remove()});$("#export").click(function(e){e.preventDefault();spinner.spin();target.appendChild(spinner.el);$.getJSON("resources/json_flatten.php",function(e){var t=genCSV(e);var n="data:text/csv;charset=utf-8,"+escape(t);var r=document.createElement("a");r.href=n;r.download="data.csv";document.body.appendChild(r);r.click();document.body.removeChild(r);spinner.stop()})});$(".search-form").on("change",".file-input",function(){this.form.submit()});$(".display-create").click(function(){$(".remove-address").trigger("click");$(".remove-phone").trigger("click");$(".form-info p").html("Fields marked with an asterisk (*) are required.");$(this).fadeOut(function(){$(".create-customer").fadeIn()});$(".form-info h4").html("")});$(".remove-display").click(function(){$(".form-info h4").html("");document.getElementById("customer-list").selectedIndex=-1;customerSeq=-1;$(".edit-form").trigger("reset");$(".customer-seq").remove();$(".address-seq").remove();$(".phone-seq").remove();$(".success-status").removeClass("success-status");$(".error-status").removeClass("error-status");$(".error-msg").remove();$(".create-customer").fadeOut(function(){$(".display-create").fadeIn();$(".create-customer h2").html("Create New");$(".submit-create").val("Create");$(".create-customer").removeClass("update");$(".submit-delete").fadeOut();$(".address-code").removeClass("zip").addClass("postal");$(".address-code").attr("placeholder","Postal Code")})});$(".address").on(".remove-address","click",function(){if($(".address").length>1){$(".address").each(function(e){var t=e+1;$(".address-name",this).html("Address "+t)});$(this).parent().detach()}else{$(".address:last .address-name").html("Address "+$(".address").length)}});$(".address").on("change",".province",function(){var e=$(this).closest(".address");if($(":selected",this).parent().attr("label")==="Canada"){$(".address-code",e).removeClass("zip").addClass("postal");$(".address-code",e).attr("placeholder","Postal Code");$(".country",e).val("Canada")}else{$(".address-code",e).removeClass("postal").addClass("zip");$(".address-code",e).attr("placeholder","Zip Code");$(".country",e).val("United States")}});$(".address").on("change",".country",function(){var e=$(this).closest(".address");if($(this).val()==="Canada"){$(".address-code",e).removeClass("zip").addClass("postal");$(".address-code",e).attr("placeholder","Postal Code");if($(".province option:selected",e).parent().attr("label")!=="Canada"){$(".province option[value='AB']",e).prop("selected",true)}}else{$(".address-code",e).removeClass("postal").addClass("zip");$(".address-code",e).attr("placeholder","Zip Code");if($(".province option:selected",e).parent().attr("label")!=="United States"){$(".province option[value='AL']",e).prop("selected",true)}}});$(".add-address").on("click",function(){$(".address").last().after($(".address").first().clone());$(".address:last .address-name").html("Address "+$(".address").length);$(".address:last .address-seq").remove();$(".remove-address").on("click",function(){if($(".address").length>1){$(".address").each(function(e){var t=e+1;$(".address-name",this).html("Address "+t)});$(this).parent().detach()}else{$(".address:last .address-name").html("Address "+$(".address").length)}});$(".address").on("change",".province",function(){var e=$(this).closest(".address");if($(":selected",this).parent().attr("label")==="Canada"){$(".address-code",e).removeClass("zip").addClass("postal");$(".address-code",e).attr("placeholder","Postal Code");$(".country",e).val("Canada")}else{$(".address-code",e).removeClass("postal").addClass("zip");$(".address-code",e).attr("placeholder","Zip Code");$(".country",e).val("United States")}});$(".address").on("change",".country",function(){var e=$(this).closest(".address");if($(this).val()==="Canada"){$(".address-code",e).removeClass("zip").addClass("postal");$(".address-code",e).attr("placeholder","Postal Code");if($(".province option:selected",e).parent().attr("label")!=="Canada"){$(".province option[value='AB']",e).prop("selected",true)}}else{$(".address-code",e).removeClass("postal").addClass("zip");$(".address-code",e).attr("placeholder","Zip Code");if($(".province option:selected",e).parent().attr("label")!=="United States"){$(".province option[value='AL']",e).prop("selected",true)}}})});$(".phone-numbers, #search-options").on("focus",".phone, .search-phone",function(){$(this).val(removePhoneFormat($(this).val()))});$(".phone-numbers, #search-options").on("blur",".phone, .search-phone",function(){$(this).val(addPhoneFormat($(this).val()))});$(".phone-number").on(".remove-phone","click",function(){if($(".phone-number").length>1){$(this).parent().parent().detach()}});$(".add-phone").on("click",function(){$(".phone-number").last().after($(".phone-number").first().clone());$(".phone-number:last .phone-seq").remove();$(".remove-phone").on("click",function(){if($(".phone-number").length>1){$(this).parent().parent().detach()}})});$(".submit-delete").hover(function(){$(".create-customer").addClass("delete")},function(){$(".create-customer").removeClass("delete")});$(".edit-form").submit(function(e){e.preventDefault();if(validateSubmit()){spinner.spin();target.appendChild(spinner.el);$.post($(this).attr("action"),$(this).serialize(),function(e){$("#customer-list").empty();if(e.length<1){$("#customer-list").html("<option>No Customers Found</option>")}$.each(e,function(e,t){$("#customer-list").append('<option value="'+t.seq+'">'+t.last_name+", "+t.first_name+" "+t.middle_name+"</option>")});customers=$();spinner.stop();if($(".submit-type").val()=="Create"){$(".remove-display").trigger("click");$(".form-info h4").html("The customer has been created.")}else if($(".submit-type").val()=="Update"){$(".form-info p").html("The customer has been updated.")}else if($(".submit-type").val()=="Delete"){$(".remove-display").trigger("click");$(".form-info h4").html("The customer has been deleted.")}},"json")}return false});$(".display-logs").click(function(){$(".logs").fadeToggle();$(this).val($(this).val()==="Show Logs"?"Hide Logs":"Show Logs")});$(".display-all").click(function(){spinner.spin();target.appendChild(spinner.el);customerSeq=-1;offset=0;$.post("controllers/logs_controller.php",function(e){limit=e;if(limit>10){$(".right-pager").fadeIn()}else{$(".right-pager").fadeOut()}});$(".left-pager").fadeOut();$.post("controllers/logs_controller.php",{customer:customerSeq},function(e){$(".logs tbody").empty();if(e.length<1){$(".logs tbody").html("<tr><td colspan='3'>No Events Found</td></tr>")}$.each(e,function(e,t){$(".logs tbody").append("<tr><td>"+t.date_time+"</td><td>"+t.action+"</td><td>"+t.class_seq+"</tr>")});spinner.stop()},"json");$(this).fadeOut()});$(".left-pager").click(function(){if(offset>=10){spinner.spin();target.appendChild(spinner.el);offset-=10;if(offset<10){offset=0}$.post("controllers/logs_controller.php",{customer:customerSeq,offset:offset},function(e){var t="";$.each(e,function(e,n){t+="<tr><td>"+n.date_time+"</td><td>"+n.action+"</td><td>"+n.class_seq+"</tr>"});if(e.length<1){t="<tr><td colspan='3'>No Events Found</td></tr>"}spinner.stop();$(".logs tbody").html(t)},"json");if(offset<10){$(".left-pager").fadeOut()}if(offset<limit-10){$(".right-pager").fadeIn()}}else{$(".left-pager").fadeOut()}});$(".right-pager").click(function(){if(offset<limit){spinner.spin();target.appendChild(spinner.el);offset+=10;$.post("controllers/logs_controller.php",{customer:customerSeq,offset:offset},function(e){var t="";$.each(e,function(e,n){t+="<tr><td>"+n.date_time+"</td><td>"+n.action+"</td><td>"+n.class_seq+"</tr>"});if(e.length<1){t="<tr><td colspan='3'>No Events Found</td></tr>"}spinner.stop();$(".logs tbody").html(t)},"json");if(offset>=limit-10){offset=limit;$(".right-pager").fadeOut()}if(offset>0){$(".left-pager").fadeIn()}}else{$(".right-pager").fadeOut()}})})
